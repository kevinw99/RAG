WARNING:root:Prometheus client not available - metrics will be stored in memory only
{"timestamp": "2025-07-31T15:42:28.539766", "level": "INFO", "logger": "rag_system.monitoring.logging_config", "message": "Logging configured: level=DEBUG, format=json, console=True, file=True", "file": "logging_config.py", "line": 158, "function": "configure_logging", "taskName": null}
ðŸš€ Starting RAG API Server...
==================================================
Server will be available at: http://localhost:8000
API Documentation: http://localhost:8000/docs
Health Check: http://localhost:8000/health
==================================================
INFO:     Will watch for changes in these directories: ['/Users/kweng/AI/RAG']
INFO:     Started server process [37098]
INFO:     Waiting for application startup.
{"timestamp": "2025-07-31T15:42:28.595650", "level": "INFO", "logger": "rag_system.api", "message": "Starting RAG API server...", "file": "server.py", "line": 136, "function": "lifespan", "taskName": "Task-2"}
{"timestamp": "2025-07-31T15:42:28.596033", "level": "INFO", "logger": "rag_system.core.pipeline", "message": "RAGPipeline created: collection=rag_documents", "file": "pipeline.py", "line": 71, "function": "__init__", "taskName": "Task-2"}
{"timestamp": "2025-07-31T15:42:28.596102", "level": "INFO", "logger": "rag_system.core.pipeline", "message": "Initializing RAG pipeline components...", "file": "pipeline.py", "line": 84, "function": "initialize", "taskName": "Task-2"}
{"timestamp": "2025-07-31T15:42:28.596165", "level": "INFO", "logger": "rag_system.core.document_processor", "message": "DocumentProcessor initialized: chunk_size=1000, chunk_overlap=100, batch_size=1000", "file": "document_processor.py", "line": 63, "function": "__init__", "taskName": "Task-2"}
{"timestamp": "2025-07-31T15:42:28.756405", "level": "INFO", "logger": "rag_system.storage.vector_store", "message": "Loading embedding model: sentence-transformers/all-MiniLM-L6-v2", "file": "vector_store.py", "line": 69, "function": "__init__", "taskName": "Task-2"}
{"timestamp": "2025-07-31T15:42:31.218888", "level": "INFO", "logger": "rag_system.storage.vector_store", "message": "Loaded embedding model with dimension: 384", "file": "vector_store.py", "line": 74, "function": "__init__", "taskName": "Task-2"}
{"timestamp": "2025-07-31T15:42:31.228876", "level": "INFO", "logger": "rag_system.storage.vector_store", "message": "Retrieved existing collection: rag_documents", "file": "vector_store.py", "line": 82, "function": "__init__", "taskName": "Task-2"}
{"timestamp": "2025-07-31T15:42:31.236000", "level": "INFO", "logger": "rag_system.core.generator", "message": "ResponseGenerator initialized: anthropic/claude-3-haiku-20240307", "file": "generator.py", "line": 305, "function": "__init__", "taskName": "Task-2"}
{"timestamp": "2025-07-31T15:42:31.363724", "level": "INFO", "logger": "rag_system.core.pipeline", "message": "Found 44287 existing chunks, initializing retriever...", "file": "pipeline.py", "line": 119, "function": "initialize", "taskName": "Task-2"}
{"timestamp": "2025-07-31T15:42:31.363866", "level": "WARNING", "logger": "rag_system.core.retriever", "message": "No chunks provided for BM25. Will use vector search only.", "file": "retriever.py", "line": 247, "function": "__init__", "taskName": "Task-2"}
{"timestamp": "2025-07-31T15:42:31.363920", "level": "INFO", "logger": "rag_system.core.retriever", "message": "Loading cross-encoder model: cross-encoder/ms-marco-MiniLM-L-6-v2", "file": "retriever.py", "line": 153, "function": "__init__", "taskName": "Task-2"}
{"timestamp": "2025-07-31T15:42:32.649441", "level": "INFO", "logger": "rag_system.core.retriever", "message": "Cross-encoder model loaded successfully", "file": "retriever.py", "line": 156, "function": "__init__", "taskName": "Task-2"}
{"timestamp": "2025-07-31T15:42:32.650658", "level": "INFO", "logger": "rag_system.core.retriever", "message": "HybridRetriever initialized: alpha=0.5, reranking=True", "file": "retriever.py", "line": 265, "function": "__init__", "taskName": "Task-2"}
{"timestamp": "2025-07-31T15:42:32.650999", "level": "INFO", "logger": "rag_system.core.pipeline", "message": "Retriever initialized with existing chunks", "file": "pipeline.py", "line": 127, "function": "initialize", "taskName": "Task-2"}
{"timestamp": "2025-07-31T15:42:32.651283", "level": "INFO", "logger": "rag_system.core.pipeline", "message": "Pipeline initialized successfully in 4.06s", "file": "pipeline.py", "line": 138, "function": "initialize", "taskName": "Task-2"}
{"timestamp": "2025-07-31T15:42:32.651514", "level": "INFO", "logger": "rag_system.api", "message": "RAG pipeline initialized successfully", "file": "server.py", "line": 141, "function": "lifespan", "taskName": "Task-2"}
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
{"timestamp": "2025-07-31T15:42:37.434659", "level": "INFO", "logger": "rag_system.api", "message": "POST /query - Request started", "file": "server.py", "line": 192, "function": "monitoring_middleware", "taskName": "Task-3", "request_id": "61441c8f"}
{"timestamp": "2025-07-31T15:42:37.436153", "level": "INFO", "logger": "rag_system.core.pipeline", "message": "Pipeline already initialized", "file": "pipeline.py", "line": 80, "function": "initialize", "taskName": "starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro"}
/opt/miniconda3/lib/python3.12/site-packages/torch/nn/modules/module.py:1762: FutureWarning: `encoder_attention_mask` is deprecated and will be removed in version 4.55.0 for `BertSdpaSelfAttention.forward`.
  return forward_call(*args, **kwargs)
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
{"timestamp": "2025-07-31T15:42:37.569630", "level": "DEBUG", "logger": "anthropic._base_client", "message": "Request options: {'method': 'post', 'url': '/v1/messages', 'files': None, 'idempotency_key': 'stainless-python-retry-a6f8f7f3-9567-458c-acb9-8ed1c1d3e393', 'json_data': {'max_tokens': 1000, 'messages': [{'role': 'user', 'content': 'Context:\\n[1] Source: optimization.pdf\\nDocument: optimization.pdf - Introduction to Modern Portfolio Theory Adding Constraints Summary Portfolio Optimization Theoretica...\\n\\nContent: Introduction to Modern Portfolio Theory Adding Constraints Summary Portfolio Optimization Theoretically, how does it work? J.G. Watson Financial Engines Retiree Research Center October 8, 2012 J.G. Watson Portfolio Optimization Introduction to Modern Portfolio Theory Adding Constraints Summary Outline 1Introduction to Modern Portfolio Theory 2Adding Constraints 3Summary J.G. Watson Portfolio Optimization Introduction to Modern Portfolio Theory Adding Constraints Summary Harry M. Markowitz Harry Markowitz described Modern Portfolio Theory in a paper appearing in the March 1952 issue of The Journal of Finance . Investors are concerned with their portfolio\u2019s expected return and risk, which is measured by a portfolio\u2019s variance of returns. They prefer higher expected returns and lower risk, but are willing to make trade offs. J.G.\\n\\n[2] Source: optimization.pdf\\nDocument: optimization.pdf - Introduction to Modern Portfolio Theory Adding Constraints Summary Portfolio Optimization Theoretica...\\n\\nContent: ptimization and better estimates of expected returns. Style Analysis and the covariance matrix. J.G. Watson Portfolio Optimization Appendix For Further Reading For Further Reading I Philip E. Gill, Walter Murray, and Margaret H. Wright Practical Optimization Academic Press, 1981 Section 5.2.1., A Model Algorithm, 168\u2013169 Section 5.3.2.1., Positive-definite quadratic programming, 177\u2013178. Harry M. Markowitz, Portfolio Selection, 2nd Edition Blackwell, Cambridge, MA, 1991. Harry M. Markowitz Portfolio Selection The Journal of Finance , 7 (1): 77\u201391, March 1952 J.G. Watson Portfolio Optimization Appendix For Further Reading For Further Reading II William F . Sharpe An Algorithm for Portfolio Improvement Advances in Mathematical Programming and Financial Planning K.D. Lawrence, J.B. Guerard, Jr., and G.D. Reeves, Editors, JAI Press, Inc., 155\u2013170, 1987. J.G. Watson Portfolio Optimization\\n\\n[3] Source: OptimizationEnhancementsSpec.doc\\nDocument: OptimizationEnhancementsSpec.doc - Engine Design Specification: Optimization Enhancements Version: 1.3 Notes: History. Table of Content...\\n\\nContent: d Quality Assurance. 36 6.0 Future Directions. 36 7.0 References. 36 8.0 Open Items. 36 1.0 Summary. This document describes additional features used in constructing portfolio recommendations that are not described in the base specification document Optimization. That document describes the construction of portfolio expected return and covariance matrices for use in mean-variance optimization. The documents Load Aware Optimization and Taxable Advice describe adjustments to fund-level or account-level data that are fed into the optimization problem. This document details several enhancements to the basic optimization framework that were created to make portfolio recommendations more palatable, easier to justify, or more sound from a fiduciary perspective. The specific features described here are: Advice Palatability Company Stock Advisability and the Diversity Budget Whole Percent Optimization Multiple Share Classes Money Market Funds S&P 500 Index Funds 3% Rule Pre-Mixed, Life-Cycle, a\\n\\nQuestion: What is portfolio optimization?\\n\\nPlease provide a comprehensive answer based on the context above. Include source references where appropriate.'}], 'model': 'claude-3-haiku-20240307', 'system': \"You are a knowledgeable assistant that answers questions based on provided context. \\nFollow these guidelines:\\n\\n1. Use ONLY the provided context to answer the question\\n2. If the context doesn't contain enough information, say so clearly\\n3. Include specific references to sources when possible\\n4. Be concise but comprehensive\\n5. If uncertain, indicate your level of confidence\\n\\nContext will be provided as numbered chunks with source information.\", 'temperature': 0.1}}", "file": "_base_client.py", "line": 493, "function": "_build_request", "taskName": "Task-8"}
{"timestamp": "2025-07-31T15:42:37.570343", "level": "DEBUG", "logger": "anthropic._base_client", "message": "Sending HTTP Request: POST https://api.anthropic.com/v1/messages", "file": "_base_client.py", "line": 1626, "function": "request", "taskName": "Task-8"}
{"timestamp": "2025-07-31T15:42:37.570689", "level": "DEBUG", "logger": "httpcore.connection", "message": "connect_tcp.started host='api.anthropic.com' port=443 local_address=None timeout=None socket_options=None", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-8"}
{"timestamp": "2025-07-31T15:42:37.572744", "level": "DEBUG", "logger": "httpcore.connection", "message": "connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x17fa8ff80>", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-8"}
{"timestamp": "2025-07-31T15:42:37.572818", "level": "DEBUG", "logger": "httpcore.connection", "message": "start_tls.started ssl_context=<ssl.SSLContext object at 0x17faaec50> server_hostname='api.anthropic.com' timeout=None", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-8"}
{"timestamp": "2025-07-31T15:42:37.620306", "level": "DEBUG", "logger": "httpcore.connection", "message": "start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x17f7cdbe0>", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-8"}
{"timestamp": "2025-07-31T15:42:37.620575", "level": "DEBUG", "logger": "httpcore.http11", "message": "send_request_headers.started request=<Request [b'POST']>", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-8"}
{"timestamp": "2025-07-31T15:42:37.620872", "level": "DEBUG", "logger": "httpcore.http11", "message": "send_request_headers.complete", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-8"}
{"timestamp": "2025-07-31T15:42:37.620928", "level": "DEBUG", "logger": "httpcore.http11", "message": "send_request_body.started request=<Request [b'POST']>", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-8"}
{"timestamp": "2025-07-31T15:42:37.621052", "level": "DEBUG", "logger": "httpcore.http11", "message": "send_request_body.complete", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-8"}
{"timestamp": "2025-07-31T15:42:37.621098", "level": "DEBUG", "logger": "httpcore.http11", "message": "receive_response_headers.started request=<Request [b'POST']>", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-8"}
{"timestamp": "2025-07-31T15:42:40.244734", "level": "DEBUG", "logger": "httpcore.http11", "message": "receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Thu, 31 Jul 2025 22:42:40 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'anthropic-ratelimit-input-tokens-limit', b'50000'), (b'anthropic-ratelimit-input-tokens-remaining', b'50000'), (b'anthropic-ratelimit-input-tokens-reset', b'2025-07-31T22:42:38Z'), (b'anthropic-ratelimit-output-tokens-limit', b'10000'), (b'anthropic-ratelimit-output-tokens-remaining', b'10000'), (b'anthropic-ratelimit-output-tokens-reset', b'2025-07-31T22:42:41Z'), (b'anthropic-ratelimit-requests-limit', b'50'), (b'anthropic-ratelimit-requests-remaining', b'49'), (b'anthropic-ratelimit-requests-reset', b'2025-07-31T22:42:38Z'), (b'anthropic-ratelimit-tokens-limit', b'60000'), (b'anthropic-ratelimit-tokens-remaining', b'60000'), (b'anthropic-ratelimit-tokens-reset', b'2025-07-31T22:42:38Z'), (b'request-id', b'req_011CRfuPr7qSUXZFKjK61pWm'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'anthropic-organization-id', b'c20be06b-ec2d-4d26-a60a-c6308d63ce1c'), (b'via', b'1.1 google'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Robots-Tag', b'none'), (b'Server', b'cloudflare'), (b'CF-RAY', b'96809c298a6fce88-SJC'), (b'Content-Encoding', b'gzip')])", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-8"}
{"timestamp": "2025-07-31T15:42:40.247417", "level": "DEBUG", "logger": "httpcore.http11", "message": "receive_response_body.started request=<Request [b'POST']>", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-8"}
{"timestamp": "2025-07-31T15:42:40.248782", "level": "DEBUG", "logger": "httpcore.http11", "message": "receive_response_body.complete", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-8"}
{"timestamp": "2025-07-31T15:42:40.249286", "level": "DEBUG", "logger": "httpcore.http11", "message": "response_closed.started", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-8"}
{"timestamp": "2025-07-31T15:42:40.249732", "level": "DEBUG", "logger": "httpcore.http11", "message": "response_closed.complete", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-8"}
{"timestamp": "2025-07-31T15:42:40.250300", "level": "DEBUG", "logger": "anthropic._base_client", "message": "HTTP Response: POST https://api.anthropic.com/v1/messages \"200 OK\" Headers({'date': 'Thu, 31 Jul 2025 22:42:40 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'anthropic-ratelimit-input-tokens-limit': '50000', 'anthropic-ratelimit-input-tokens-remaining': '50000', 'anthropic-ratelimit-input-tokens-reset': '2025-07-31T22:42:38Z', 'anthropic-ratelimit-output-tokens-limit': '10000', 'anthropic-ratelimit-output-tokens-remaining': '10000', 'anthropic-ratelimit-output-tokens-reset': '2025-07-31T22:42:41Z', 'anthropic-ratelimit-requests-limit': '50', 'anthropic-ratelimit-requests-remaining': '49', 'anthropic-ratelimit-requests-reset': '2025-07-31T22:42:38Z', 'anthropic-ratelimit-tokens-limit': '60000', 'anthropic-ratelimit-tokens-remaining': '60000', 'anthropic-ratelimit-tokens-reset': '2025-07-31T22:42:38Z', 'request-id': 'req_011CRfuPr7qSUXZFKjK61pWm', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'anthropic-organization-id': 'c20be06b-ec2d-4d26-a60a-c6308d63ce1c', 'via': '1.1 google', 'cf-cache-status': 'DYNAMIC', 'x-robots-tag': 'none', 'server': 'cloudflare', 'cf-ray': '96809c298a6fce88-SJC', 'content-encoding': 'gzip'})", "file": "_base_client.py", "line": 1664, "function": "request", "taskName": "Task-8"}
{"timestamp": "2025-07-31T15:42:40.253080", "level": "DEBUG", "logger": "anthropic._base_client", "message": "request_id: req_011CRfuPr7qSUXZFKjK61pWm", "file": "_base_client.py", "line": 1672, "function": "request", "taskName": "Task-8"}
{"timestamp": "2025-07-31T15:42:40.284637", "level": "INFO", "logger": "rag_system.api", "message": "POST /query - Completed in 2.850s with status 200", "file": "server.py", "line": 210, "function": "monitoring_middleware", "taskName": "Task-3", "request_id": "61441c8f"}
INFO:     127.0.0.1:53158 - "POST /query HTTP/1.1" 200 OK
{"timestamp": "2025-07-31T15:43:14.725181", "level": "INFO", "logger": "rag_system.api", "message": "GET /health - Request started", "file": "server.py", "line": 192, "function": "monitoring_middleware", "taskName": "Task-12", "request_id": "417851c7"}
{"timestamp": "2025-07-31T15:43:15.746256", "level": "INFO", "logger": "rag_system.storage.vector_store", "message": "Loading embedding model: sentence-transformers/all-MiniLM-L6-v2", "file": "vector_store.py", "line": 69, "function": "__init__", "taskName": "starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro"}
{"timestamp": "2025-07-31T15:43:17.440566", "level": "INFO", "logger": "rag_system.storage.vector_store", "message": "Loaded embedding model with dimension: 384", "file": "vector_store.py", "line": 74, "function": "__init__", "taskName": "starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro"}
{"timestamp": "2025-07-31T15:43:17.449461", "level": "INFO", "logger": "rag_system.storage.vector_store", "message": "Retrieved existing collection: rag_documents", "file": "vector_store.py", "line": 82, "function": "__init__", "taskName": "starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro"}
/opt/miniconda3/lib/python3.12/site-packages/torch/nn/modules/module.py:1762: FutureWarning: `encoder_attention_mask` is deprecated and will be removed in version 4.55.0 for `BertSdpaSelfAttention.forward`.
  return forward_call(*args, **kwargs)
{"timestamp": "2025-07-31T15:43:19.534551", "level": "INFO", "logger": "rag_system.monitoring", "message": "Health checks completed in 4.809s - Status: healthy", "file": "health.py", "line": 103, "function": "run_health_checks", "taskName": "starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro"}
{"timestamp": "2025-07-31T15:43:19.605064", "level": "INFO", "logger": "rag_system.api", "message": "GET /health - Completed in 4.880s with status 200", "file": "server.py", "line": 210, "function": "monitoring_middleware", "taskName": "Task-12", "request_id": "417851c7"}
INFO:     127.0.0.1:53360 - "GET /health HTTP/1.1" 200 OK
{"timestamp": "2025-07-31T15:43:19.607867", "level": "INFO", "logger": "rag_system.api", "message": "POST /query - Request started", "file": "server.py", "line": 192, "function": "monitoring_middleware", "taskName": "Task-15", "request_id": "b44c4c7c"}
{"timestamp": "2025-07-31T15:43:19.608305", "level": "INFO", "logger": "rag_system.core.pipeline", "message": "Pipeline already initialized", "file": "pipeline.py", "line": 80, "function": "initialize", "taskName": "starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro"}
{"timestamp": "2025-07-31T15:43:19.664316", "level": "DEBUG", "logger": "anthropic._base_client", "message": "Request options: {'method': 'post', 'url': '/v1/messages', 'files': None, 'idempotency_key': 'stainless-python-retry-6d44427c-2727-4665-8b83-6fe5fb0cd6cd', 'json_data': {'max_tokens': 1000, 'messages': [{'role': 'user', 'content': 'Context:\\n[1] Source: optimization.pdf\\nDocument: optimization.pdf - Introduction to Modern Portfolio Theory Adding Constraints Summary Portfolio Optimization Theoretica...\\n\\nContent: Introduction to Modern Portfolio Theory Adding Constraints Summary Portfolio Optimization Theoretically, how does it work? J.G. Watson Financial Engines Retiree Research Center October 8, 2012 J.G. Watson Portfolio Optimization Introduction to Modern Portfolio Theory Adding Constraints Summary Outline 1Introduction to Modern Portfolio Theory 2Adding Constraints 3Summary J.G. Watson Portfolio Optimization Introduction to Modern Portfolio Theory Adding Constraints Summary Harry M. Markowitz Harry Markowitz described Modern Portfolio Theory in a paper appearing in the March 1952 issue of The Journal of Finance . Investors are concerned with their portfolio\u2019s expected return and risk, which is measured by a portfolio\u2019s variance of returns. They prefer higher expected returns and lower risk, but are willing to make trade offs. J.G.\\n\\n[2] Source: optimization.pdf\\nDocument: optimization.pdf - Introduction to Modern Portfolio Theory Adding Constraints Summary Portfolio Optimization Theoretica...\\n\\nContent: ptimization and better estimates of expected returns. Style Analysis and the covariance matrix. J.G. Watson Portfolio Optimization Appendix For Further Reading For Further Reading I Philip E. Gill, Walter Murray, and Margaret H. Wright Practical Optimization Academic Press, 1981 Section 5.2.1., A Model Algorithm, 168\u2013169 Section 5.3.2.1., Positive-definite quadratic programming, 177\u2013178. Harry M. Markowitz, Portfolio Selection, 2nd Edition Blackwell, Cambridge, MA, 1991. Harry M. Markowitz Portfolio Selection The Journal of Finance , 7 (1): 77\u201391, March 1952 J.G. Watson Portfolio Optimization Appendix For Further Reading For Further Reading II William F . Sharpe An Algorithm for Portfolio Improvement Advances in Mathematical Programming and Financial Planning K.D. Lawrence, J.B. Guerard, Jr., and G.D. Reeves, Editors, JAI Press, Inc., 155\u2013170, 1987. J.G. Watson Portfolio Optimization\\n\\n[3] Source: OptimizationEnhancementsSpec.doc\\nDocument: OptimizationEnhancementsSpec.doc - Engine Design Specification: Optimization Enhancements Version: 1.3 Notes: History. Table of Content...\\n\\nContent: d Quality Assurance. 36 6.0 Future Directions. 36 7.0 References. 36 8.0 Open Items. 36 1.0 Summary. This document describes additional features used in constructing portfolio recommendations that are not described in the base specification document Optimization. That document describes the construction of portfolio expected return and covariance matrices for use in mean-variance optimization. The documents Load Aware Optimization and Taxable Advice describe adjustments to fund-level or account-level data that are fed into the optimization problem. This document details several enhancements to the basic optimization framework that were created to make portfolio recommendations more palatable, easier to justify, or more sound from a fiduciary perspective. The specific features described here are: Advice Palatability Company Stock Advisability and the Diversity Budget Whole Percent Optimization Multiple Share Classes Money Market Funds S&P 500 Index Funds 3% Rule Pre-Mixed, Life-Cycle, a\\n\\nQuestion: What is portfolio optimization?\\n\\nPlease provide a comprehensive answer based on the context above. Include source references where appropriate.'}], 'model': 'claude-3-haiku-20240307', 'system': \"You are a knowledgeable assistant that answers questions based on provided context. \\nFollow these guidelines:\\n\\n1. Use ONLY the provided context to answer the question\\n2. If the context doesn't contain enough information, say so clearly\\n3. Include specific references to sources when possible\\n4. Be concise but comprehensive\\n5. If uncertain, indicate your level of confidence\\n\\nContext will be provided as numbered chunks with source information.\", 'temperature': 0.1}}", "file": "_base_client.py", "line": 493, "function": "_build_request", "taskName": "Task-20"}
{"timestamp": "2025-07-31T15:43:19.664779", "level": "DEBUG", "logger": "anthropic._base_client", "message": "Sending HTTP Request: POST https://api.anthropic.com/v1/messages", "file": "_base_client.py", "line": 1626, "function": "request", "taskName": "Task-20"}
{"timestamp": "2025-07-31T15:43:19.665007", "level": "DEBUG", "logger": "httpcore.connection", "message": "close.started", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-20"}
{"timestamp": "2025-07-31T15:43:19.665244", "level": "DEBUG", "logger": "httpcore.connection", "message": "close.complete", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-20"}
{"timestamp": "2025-07-31T15:43:19.665332", "level": "DEBUG", "logger": "httpcore.connection", "message": "connect_tcp.started host='api.anthropic.com' port=443 local_address=None timeout=None socket_options=None", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-20"}
{"timestamp": "2025-07-31T15:43:19.672105", "level": "DEBUG", "logger": "httpcore.connection", "message": "connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x17af59fa0>", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-20"}
{"timestamp": "2025-07-31T15:43:19.672189", "level": "DEBUG", "logger": "httpcore.connection", "message": "start_tls.started ssl_context=<ssl.SSLContext object at 0x17faaec50> server_hostname='api.anthropic.com' timeout=None", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-20"}
{"timestamp": "2025-07-31T15:43:19.717269", "level": "DEBUG", "logger": "httpcore.connection", "message": "start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x17af5a090>", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-20"}
{"timestamp": "2025-07-31T15:43:19.717568", "level": "DEBUG", "logger": "httpcore.http11", "message": "send_request_headers.started request=<Request [b'POST']>", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-20"}
{"timestamp": "2025-07-31T15:43:19.717801", "level": "DEBUG", "logger": "httpcore.http11", "message": "send_request_headers.complete", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-20"}
{"timestamp": "2025-07-31T15:43:19.717867", "level": "DEBUG", "logger": "httpcore.http11", "message": "send_request_body.started request=<Request [b'POST']>", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-20"}
{"timestamp": "2025-07-31T15:43:19.718004", "level": "DEBUG", "logger": "httpcore.http11", "message": "send_request_body.complete", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-20"}
{"timestamp": "2025-07-31T15:43:19.718061", "level": "DEBUG", "logger": "httpcore.http11", "message": "receive_response_headers.started request=<Request [b'POST']>", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-20"}
{"timestamp": "2025-07-31T15:43:22.746380", "level": "DEBUG", "logger": "httpcore.http11", "message": "receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Thu, 31 Jul 2025 22:43:22 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'anthropic-ratelimit-input-tokens-limit', b'50000'), (b'anthropic-ratelimit-input-tokens-remaining', b'50000'), (b'anthropic-ratelimit-input-tokens-reset', b'2025-07-31T22:43:21Z'), (b'anthropic-ratelimit-output-tokens-limit', b'10000'), (b'anthropic-ratelimit-output-tokens-remaining', b'10000'), (b'anthropic-ratelimit-output-tokens-reset', b'2025-07-31T22:43:24Z'), (b'anthropic-ratelimit-requests-limit', b'50'), (b'anthropic-ratelimit-requests-remaining', b'49'), (b'anthropic-ratelimit-requests-reset', b'2025-07-31T22:43:21Z'), (b'anthropic-ratelimit-tokens-limit', b'60000'), (b'anthropic-ratelimit-tokens-remaining', b'60000'), (b'anthropic-ratelimit-tokens-reset', b'2025-07-31T22:43:21Z'), (b'request-id', b'req_011CRfuSxyv6ZZqEhRpEoucX'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'anthropic-organization-id', b'c20be06b-ec2d-4d26-a60a-c6308d63ce1c'), (b'via', b'1.1 google'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Robots-Tag', b'none'), (b'Server', b'cloudflare'), (b'CF-RAY', b'96809d30bb975c19-SJC'), (b'Content-Encoding', b'gzip')])", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-20"}
{"timestamp": "2025-07-31T15:43:22.747825", "level": "DEBUG", "logger": "httpcore.http11", "message": "receive_response_body.started request=<Request [b'POST']>", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-20"}
{"timestamp": "2025-07-31T15:43:22.748762", "level": "DEBUG", "logger": "httpcore.http11", "message": "receive_response_body.complete", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-20"}
{"timestamp": "2025-07-31T15:43:22.749041", "level": "DEBUG", "logger": "httpcore.http11", "message": "response_closed.started", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-20"}
{"timestamp": "2025-07-31T15:43:22.749385", "level": "DEBUG", "logger": "httpcore.http11", "message": "response_closed.complete", "file": "_trace.py", "line": 87, "function": "atrace", "taskName": "Task-20"}
{"timestamp": "2025-07-31T15:43:22.749850", "level": "DEBUG", "logger": "anthropic._base_client", "message": "HTTP Response: POST https://api.anthropic.com/v1/messages \"200 OK\" Headers({'date': 'Thu, 31 Jul 2025 22:43:22 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'anthropic-ratelimit-input-tokens-limit': '50000', 'anthropic-ratelimit-input-tokens-remaining': '50000', 'anthropic-ratelimit-input-tokens-reset': '2025-07-31T22:43:21Z', 'anthropic-ratelimit-output-tokens-limit': '10000', 'anthropic-ratelimit-output-tokens-remaining': '10000', 'anthropic-ratelimit-output-tokens-reset': '2025-07-31T22:43:24Z', 'anthropic-ratelimit-requests-limit': '50', 'anthropic-ratelimit-requests-remaining': '49', 'anthropic-ratelimit-requests-reset': '2025-07-31T22:43:21Z', 'anthropic-ratelimit-tokens-limit': '60000', 'anthropic-ratelimit-tokens-remaining': '60000', 'anthropic-ratelimit-tokens-reset': '2025-07-31T22:43:21Z', 'request-id': 'req_011CRfuSxyv6ZZqEhRpEoucX', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'anthropic-organization-id': 'c20be06b-ec2d-4d26-a60a-c6308d63ce1c', 'via': '1.1 google', 'cf-cache-status': 'DYNAMIC', 'x-robots-tag': 'none', 'server': 'cloudflare', 'cf-ray': '96809d30bb975c19-SJC', 'content-encoding': 'gzip'})", "file": "_base_client.py", "line": 1664, "function": "request", "taskName": "Task-20"}
{"timestamp": "2025-07-31T15:43:22.750240", "level": "DEBUG", "logger": "anthropic._base_client", "message": "request_id: req_011CRfuSxyv6ZZqEhRpEoucX", "file": "_base_client.py", "line": 1672, "function": "request", "taskName": "Task-20"}
{"timestamp": "2025-07-31T15:43:22.754234", "level": "INFO", "logger": "rag_system.api", "message": "POST /query - Completed in 3.146s with status 200", "file": "server.py", "line": 210, "function": "monitoring_middleware", "taskName": "Task-15", "request_id": "b44c4c7c"}
INFO:     127.0.0.1:53366 - "POST /query HTTP/1.1" 200 OK
INFO:     Shutting down
INFO:     Waiting for application shutdown.
{"timestamp": "2025-07-31T15:44:30.765871", "level": "INFO", "logger": "rag_system.api", "message": "Shutting down RAG API server...", "file": "server.py", "line": 149, "function": "lifespan", "taskName": "Task-2"}
INFO:     Application shutdown complete.
INFO:     Finished server process [37098]
/opt/miniconda3/lib/python3.12/multiprocessing/resource_tracker.py:254: UserWarning: resource_tracker: There appear to be 1 leaked semaphore objects to clean up at shutdown
  warnings.warn('resource_tracker: There appear to be %d '
